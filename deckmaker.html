<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="5NzYWNH5_YUg0dUV2iCzg_bSo7M1lLJi6IzOeF2dGXM" />
    <title>モスロギア 神託のメソロギア デッキメーカー</title>
    <link href="favicon.ico" rel="icon" type="image/png" />
    <!-- 検索キーワード -->
    <meta name="keywords" content=
    "カードゲーム,デッキメーカー,DCG,神託のメソロギア,メソロギア,神託,デッキ分析,一覧,モスロギア">
    <!-- ページの説明（検索結果の下に表示） -->
    <meta name="description" content=
    "このサイトは、アプリ「神託のメソロギア」のカード一覧、デッキ構築、デッキ分析ができる非公式サイトです。カード検索やデッキ管理をスマホでも快適に！">


        <!-- OGP基本 -->
        <meta property="og:title" content="モスロギア | 神託のメソロギア デッキメーカー">
        <meta property="og:description" content="このサイトはアプリ「神託のメソロギア」のカード検索・デッキ構築ができる非公式サイトです。">
        <meta property="og:image" content="https://mosurogia.github.io/mesorogia-cards/img/deckmakerogp.webp">
        <meta property="og:url" content="https://mosurogia.github.io/mesorogia-cards/deckmaker.html">
        <meta property="og:type" content="website">
        <meta property="og:site_name" content="モスロギア | 神託のメソロギア デッキメーカー">

        <!-- Twitterカード向け -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="モスロギア | 神託のメソロギア デッキメーカー">
        <meta name="twitter:description" content="カード検索とデッキ構築で神託のメソロギアをもっと楽しもう！">
        <meta name="twitter:image" content="https://mosurogia.github.io/mesorogia-cards/img/deckmakerogp.webp">


    <!-- CSS -->
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/common-page124.css">
    <link rel="stylesheet" href="css/common-page234.css">
    <link rel="stylesheet" href="css/common-page24.css">
    <link rel="stylesheet" href="css/page2.css">

<!--棒グラフ外部リソース-->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

<!--画像生成-->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>

<body>
<!-- ヘッダー -->
<header class="main-header">
    <div class="header-logo">
        <img src="img/tatudosi.webp" alt="神託のメソロギア ロゴ" />
    </div>
    <nav class="header-nav">
        <a href="index.html">📖 一覧</a>
        <a class="active-page" href="deckmaker.html">🃏 デッキメーカー</a>
        <a href="cardcheker.html">📊 所持率チェッカー</a>
        <!--<a href="#" style="text-decoration: line-through; pointer-events: none; color: #aaa;">📤 デッキ投稿</a>-->
        <a href="deck-post.html">📤 デッキ投稿</a>
    </nav>
</header>

<!--タブ切り替え-->
<div class="tab-bar">
    <div id="tab1" class="tab active" onclick="switchTab('build', this)">
        <span>🃏 デッキ構築</span>
    </div>
    <div id="tab2" class="tab" onclick="switchTab('edit', this)">
        <span>📤 分析＆投稿</span>
    </div>
</div>

<!-- キャンペーン告知（ミニ：タブバー直下 / 開催中のみ表示） -->
<div id="campaign-mini" class="campaign-mini" style="display:none;">
    <div class="campaign-mini-inner">
        <span class="campaign-mini-emoji" aria-hidden="true">🎉</span>

        <!-- ★JSが差し込む先（id一致必須） -->
        <span id="campaign-mini-text" class="campaign-mini-text"></span>

        <!-- ★ここだけがモーダル起動 -->
        <button type="button" class="campaign-mini-link" data-open="campaignDetailModal">
            詳細
        </button>
    </div>
</div>


<!--デッキ構築タブ-->
<div class="tab-content active" id="build">

    <!--メニューバー＆デッキバー上部固定用-->
    <div class="fixed-top-bar">
        <!--メニューバー-->
        <div class="search-bar">
            <input id="keyword" oninput="applyFilters()" placeholder="カード検索" type="text">
            <button id="toggleOwnedBtn" onclick="toggleOwned()">所持カード未反映</button>
            <select id="sort-select" onchange="sortCards()">
                <option value="default">通常順</option>
                <option value="cost-asc">コスト昇順</option>
                <option value="cost-desc">コスト降順</option>
                <option value="power-asc">パワー昇順</option>
                <option value="power-desc">パワー降順</option>
                <option value="category-order">カテゴリ順</option>
                <option value="rarity-order">レアリティ順</option>
            </select>
            <button onclick="openFilterModal()">📊 フィルター</button>
        </div>

        <!--フィルターモーダル-->
        <div class="modal" id="filterModal">
            <div class="modal-content">
                <h3 class="filter-maintitle">フィルター内容</h3>
                <div id="main-filters">
                    <!--フィルターボタン内容-->
                </div>
                <!-- 詳細フィルター -->
                <h4 class="filter-subtitle">さらに詳しい条件フィルター</h4>
                <div id="detail-filters"></div>

                <!--下部ボタン-->
                <div class="modal-footer">
                    <button class="modal-buttun" id="applyFilterBtn">この条件で絞り込む</button>
                    <button class="modal-buttun" onclick="resetFilters()">リセット</button>
                </div>
            </div>
        </div>


<!--デッキバー-->
<!-- 🔽 デッキバー全体のラッパーを追加 -->
<div class="deck-bar-wrapper">
    <div class="deck-bar-scroll">
        <div class="deck-bar-content">
            <div class="deck-bar-top" id="deckBarTop">
                <div id="deck-empty-text">
                    <div>カード操作</div>
                    <div class="deck-help" id="deckHelp">
                        <div>
                            【PC】<br>
                            ・左クリック：追加<br>
                            ・右クリック：削除<br>
                        </div>
                        <div>
                            【スマホ】<br>
                            ・タップ,上フリック：追加<br>
                            ・下フリック：削除<br>
                            ・長押し：拡大表示
                        </div>
                    </div>
                </div>
                <!-- JSでカードが並ぶ -->
            </div>
        </div>
    </div>

    <!-- デッキサマリー＆投稿ボタン -->
    <div class="deck-summary" id="deck-summary">
        <div class="deck-info"></div>
        <!-- デッキサマリー＆操作ボタン -->
        <div class="analyze-button-wrapper">
            <!-- 上段：投稿 ＋ ？ -->
            <div class="analyze-row-top">
                <!-- 分析＆投稿タブへ飛ぶボタン -->
                <button class="analyze-button" type="button" onclick="goToAnalyzeTab()">
                    📤 投稿へ
                </button>

                <!-- 投稿の流れヘルプ（？アイコン） -->
                <button type="button" class="analyze-button analyze-help-button" id="post-flow-help-btn-top" aria-label="デッキ投稿までの流れを確認">
                    ？
                </button>
            </div>

            <!-- 下段：デッキリセット -->
            <button id="resetDeckButton" type="button" class="analyze-button">
                デッキリセット
            </button>
        </div>
    </div>

    <button class="deck-summary-toggle" onclick="toggleDeckSummary()">◀</button>
</div>


<!--使用不可種族表示非表示ボタン-->
<div class="deck-filter-bar">
    <button id="toggle-invalid-race" class="filter-toggle-button">✅使用不可種族を表示(モノクロ)</button>
</div>
</div>

    <!--カード一覧-->
    <div class="grid" id="grid">

    </div>


<!-- カード拡大モーダル（画像のみ） -->
<div id="cardZoomModal" class="modal" style="display:none;">
    <div class="modal-content card-zoom" style="position:relative">
        <button id="cardZoomClose" aria-label="閉じる"
            style="position:absolute;right:.5rem;top:.5rem;font-size:1.25rem;">×</button>
        <img id="zoomImage" alt=""
            style="max-width:90vw;max-height:85vh;object-fit:contain;display:block;margin:auto;" />
    </div>
</div>


</div>

<!--デッキ編集タブ-->
<div class="tab-content" id="edit">
    <div id="deck-layout">
        <!--デッキリストゾーン-->
        <div id="deck-card-list" class="deck-section">
            <div id="deckcard-empty-message">デッキがここに表示されます</div>
            <!-- カード一覧（5列グリッド） -->
        </div>


        <!--デッキ情報ゾーン-->
        <div id="deck-info" class="deck-section">
        <!-- サブタブ -->
        <div class="tab-bar subtab-bar">
                <div class="info-tab-bar tab active" onclick="switchTab('info-tab', this)">
                    <span>📋 デッキ情報</span>
                </div>
                <div class="post-tab-bar tab" onclick="switchTab('post-tab', this)">
                    <span>📤 デッキ投稿</span>
                    <!-- デッキ投稿の流れヘルプ（サブタブ右側） -->
                    <button type="button" id="post-flow-help-btn-form" class="subtab-help-button" aria-label="デッキ投稿までの流れを確認">
                        ？
                    </button>
                </div>
        </div>


        <!--タブ内-->
        <div class="tab-contents-group">

        <!-- デッキ情報タブ -->
        <div class=" tab-content active" id="info-tab">
            <div class="info-section">

                <!-- デッキ名入力欄 -->
                <div class="info-row">
                    <label class="info-label">デッキ名</label>
                    <div class="info-value">
                        <input type="text" id="info-deck-name" placeholder="デッキ名を入力">
                    </div>
                </div>

                <!-- デッキ枚数 -->
                <div class="info-row">
                    <div class="info-label">デッキ枚数</div>
                    <div class="info-value">
                        <span id="deck-count">0</span>/30~40
                    </div>
                </div>

                <!-- メインカード -->
                <div class="info-row">
                    <div class="info-label">メインカード</div>
                    <div class="info-value">
                        <span id="deck-representative" class="tap-target" role="button" aria-label="メインカードを選択（タップで開く）"></span><br><span class="post-representative-hint">
                            デッキ投稿に表示するサムネカードです、クリック／タップで選択できます。
                        </span></div>
                </div>

                <!-- 旧神状況 -->
                <div class="info-row">
                    <div class="info-label">旧神</div>
                    <div class="info-value" id="deck-eldergod">未採用</div>
                </div>

                <!-- 使用種族 -->
                <div class="info-row">
                    <div class="info-label">メイン種族</div>
                    <div class="info-value" id="deck-races">未選択</div>
                </div>

                <!--レアリティ構成-->
                <div class="info-row">
                    <div class="info-label">レアリティ構成</div>
                    <div class="info-value" id="rarity-summary">🌈レジェンド0枚 🟡ゴールド0枚 ⚪️シルバー0枚 🟤ブロンズ0枚</div>
                </div>

                <!-- 使用タイプ内訳 -->
                <div class="info-row">
                    <div class="info-label">タイプ構成</div>
                    <div class="info-value">
                        <div id="type-summary" class="type-summary">
                            <!-- JSでチップを自動挿入 -->
                        </div>
                    </div>
                </div>

                <!--総コスト＆パワー-->
                <div class="info-row">
                    <div class="info-label">総コスト</div>
                    <div class="info-value"><span id="total-cost">0</span>コスト</div>
                </div>
                <div class="info-row">
                    <div class="info-label">総パワー</div>
                    <div class="info-value">
                        <div id="power-summary" class="type-summary"></div>
                        <span id="total-power" style="display:none;"></span>
                    </div>
                </div>

                <!--マリガン練習 -->
                <div class="mulligan-trainer" id="mulligan-trainer">
                    <div class="mull-remaining-title">マリガンシミュレーション</div>

                    <!-- デッキ不足メッセージ -->
                    <div class="mull-warning" id="mull-warning" hidden>
                        デッキにカードを追加してください（30枚以上が必要です）
                    </div>

                    <div class="mull-layout">
                        <!-- 手札4枚 -->
                        <div class="hand-area" id="mull-hand">
                            <!-- JSで4枚分のカードが入ります -->
                        </div>

                        <!-- 操作画面 -->
                        <div class="mull-actions">
                            <button type="button" id="btn-mull-or-reset" class="btn-mulligan" disabled>手札リセット</button>
                            <div class="mull-hint">画像をタップで選択／解除できます。※選択したカードはマリガン対象から除外されます。</div>
                            <div class="mull-remaining">
                                <div class="mull-remaining-title">残りの山札（タイプ別）</div>
                                <ul id="mull-remaining-by-type" class="mull-remaining-list"></ul>
                            </div>

                        </div>

                    </div>
                </div>

                <!--グラフ分布-->
                <div class="chart">
                    <div class="info-label">コスト分布</div>
                    <canvas id="costChart"></canvas>
                </div>
                <div class="chart">
                    <div class="info-label">パワー分布</div>
                    <canvas id="powerChart"></canvas>
                </div>

                <!--所持データ情報-->
                <div class="owned-info" id="owned-info">
                <div class="owned-head">所持データ反映部分</div>
                <div class="owned-note">※所持率チェッカーでの所持データをもとに計算しています</div>

                <!-- 未所持カード -->
                <div class="info-row" style="justify-content:flex-start;">
                    <div class="info-label">未所持枚数</div>
                    <div class="button-info">
                    <div id="shortage-summary-line">🌈レジェンド0枚 🟡ゴールド0枚 ⚪️シルバー0枚 🟤ブロンズ0枚</div>
                    <button id="shortage-toggle-btn" type="button">未所持カードリスト</button>
                    </div>

                </div>
                <div id="shortage-collapsible" class="shortage-collapsible" hidden>
                </div><!-- ← 開閉式リスト -->

                <!-- 必要ポイント/ダイヤ/砂 -->
                <div class="info-row" style="justify-content:flex-start;">
                    <div class="info-label">必要ポイント</div>
                    <div>
                    <div class="button-info">
                        <button id="exchange-toggle-btn-compact" type="button">🟢 ポイント</button>

                        <!-- 合計の表示だけを入れる領域（JSで毎回書き換える） -->
                        <div id="exchange-values-compact" class="exchange-values"></div>
                    </div>
                    <!-- パック別ポイント内訳は合計とは別領域として維持 -->
                    <div id="point-by-pack" class="by-pack-list"></div>
                    <div class="owned-note">
                        必要なポイント/ダイヤ/砂を確認できます<br>
                        ボタンで変更可
                    </div>
                    </div>
                    </div>
                </div>
            </div>
            <!-- 出力・保存 -->
            <div class="deck-code-controls">
                <button id="exportPngBtn">画像生成</button>
                <button id="resetDeckButton">デッキリセット</button>
                <button onclick="saveDeckToLocalStorage()">💾デッキ保存</button>
            </div>
            <!-- 👆ここまで“元の #deck-info 中身” -->
        </div>

        <!-- デッキ投稿タブ -->
        <div id="post-tab" class="tab-content">
        <form id="deck-post-form" onsubmit="return submitDeckPost(event)">
            <div class="info-section">
                <div class="info-row">
                    <label class="info-label">デッキ名</label>
                    <div class="info-value">
                        <input type="text" id="post-deck-name" name="title" placeholder="デッキ名を入力（必須）" maxlength="40" required>
                    </div>
                </div>

                <div class="info-row">
                    <label class="info-label">デッキ枚数</label>
                    <div class="info-value">
                        <span id="post-deck-count">0</span>/30~40
                    </div>
                </div>

                <!-- メインカード -->
                <div class="info-row">
                    <label class="info-label">メインカード</label>
                <div class="info-value">
                    <span id="post-representative" class="tap-target" role="button" aria-label="メインカードを選択（タップで開く）"></span><br>
                    <span class="post-representative-hint">
                        保存デッキや投稿時のサムネカードです、カード名をタップして選択できます。
                    </span>
                    <!-- メインカード未選択時のバルーン表示用（見えない入力） -->
                    <input type="text" id="post-rep-validator" aria-hidden="true" tabindex="-1"
                        style="position:absolute;opacity:0;pointer-events:none;width:1px;height:1px;border:none;padding:0;margin:0;">
                </div>
                </div>

                <div class="info-row">
                    <label class="info-label">デッキ解説</label>
                    <div class="info-value">
                    <div class="note-toolbar">
                        <!-- 左:プリセットボタン -->
                        <div class="note-presets-grid">
                            <button type="button" class="note-preset-btn" data-preset="deck-overview">デッキ概要</button>
                            <button type="button" class="note-preset-btn" data-preset="play-guide">プレイ方針</button>
                            <button type="button" class="note-preset-btn" data-preset="matchup">対面考察</button>
                            <button type="button" class="note-preset-btn" data-preset="results">実績レポート</button>
                        </div>

                        <!-- 右：全表示ボタン -->
                        <div class="note-toolbar-right">
                            <button id="note-fullscreen-btn" class="note-showall-btn" type="button">全表示</button>
                        </div>
                    </div>
                    <div class="post-hint">
                        ※上のプリセットボタンを押すとカーソル位置に定型文が挿入されます。
                    </div>
                    <textarea id="post-note" name="note" rows="10" placeholder="デッキの動きやプレイ方針などを自由に書いてください。プリセットで雛形を挿入できます"required></textarea>
                    </div>
                </div>

                <!-- ▼ カード解説（複数可） -->
                <div class="info-row">
                    <label class="info-label any">
                        <div>カード解説</div>
                        <div class="any-text">(任意)</div>
                    </label>
                    <div class="info-value" style="width:100%">
                        <div id="post-card-notes">
                            <!-- JSで行を生成 -->
                        </div>
                <!-- ▼ 復元データミラー用（JSON文字列） -->
                        <input type="hidden" id="post-card-notes-hidden" value="[]">
                        <!-- カード解説のバリデーション用（カード選択済みで本文が空の行がある場合にバルーン表示） -->
                        <input type="text" id="post-cardnote-validator" aria-hidden="true" tabindex="-1"
                            style="position:absolute;opacity:0;pointer-events:none;width:1px;height:1px;border:none;padding:0;margin:0;">

                        <div class="add-note-box">
                            <button type="button" id="add-card-note" class="add-note-btn">カード解説を追加</button>
                            <div class="post-hint" style="opacity:.8">※カードを選んで簡単な解説や採用理由を書けます</div>
                        </div>

                        </div>
                    </div>
                </div>

                <div class="info-row">
                    <div class="info-label any">
                        <div>タグ</div>
                        <div class="any-text">(任意)</div>
                    </div>
                    <div class="info-value" id="post-tags">
                        <div id="auto-tags" class="tag-chips"></div>
                        <div id="select-tags" class="tag-chips"></div>
                    </div>
                </div>

                <!-- ユーザータグ -->
                <div class="info-row">
                    <div class="info-label any">
                        <div>ユーザータグ</div>
                        <div class="any-text">(任意)</div>
                    </div>
                    <div class="info-value">
                        <div id="user-tags" class="tag-chips user-tags"></div>

                        <div style="display:flex; gap:6px; margin-top:6px;">
                            <input id="user-tag-input" class="user-tag-input"
                            type="text"
                            placeholder="タグを入力してください" maxlength="15"
                            aria-label="ユーザータグ入力" autocomplete="off" name="userTagInput">
                            <button id="user-tag-suggest" type="button" class="add-note-btn">候補</button>
                            <button id="user-tag-add" type="button" class="add-note-btn">＋追加</button>
                        </div>

                        <!-- 候補表示エリア（普段は非表示） -->
                        <div id="user-tag-suggest-box" class="tag-chips user-tag-suggest-box" style="margin-top:6px; display:none;"></div>

                        <div class="post-hint">
                            オリジナルのタグを入力できます。最大3個まで。
                        </div>
                    </div>
                </div>


                <!-- ▼ 共有コード（ユーザー貼り付け／解析しない） -->
                <div class="info-row">
                <label class="info-label any">
                    <div>デッキコード</div>
                    <div class="any-text">(任意)</div>
                </label>
                <div class="paste-code-block">
                    <div class="paste-code-controls">
                        <button id="btn-paste-code" type="button">📋 貼り付け</button>
                        <button id="btn-clear-code" type="button" disabled>🗑 削除</button>
                    </div>
                    <div class="paste-code-preview">
                        <span class="label">貼り付けコード</span>
                        <span id="pasted-code-preview">（未設定）</span>
                    </div>
                <div class="post-hint">
                    ※デッキ投稿にデッキコードを載せられます<br>
                    　ゲームアプリ内の共有コードをコピーして貼り付けてください
                </div>
                </div>
                </div>

                <!-- ▼ ログイン状態表示（投稿フォームとは独立） -->
                <div class="info-row">
                    <div class="info-label any">
                        <div>ログイン</div>
                        <div class="any-text">(任意)</div>
                    </div>

                    <div class="info-value">

                        <!-- 未ログイン時に出す： -->
                        <div id="auth-mini-loggedout" style="display:none;">
                            <div class="auth-mini-header">
                                <span class="auth-mini-title">未ログイン</span>
                                <button type="button" id="open-login-modal" class="auth-mini-btn" data-open="authLoginModal">
                                    ログイン / 新規登録
                                </button>
                            </div>

                            <div class="post-hint">
                                ユーザーIDは投稿者名とは別です。<br>
                                投稿者名やXアカウントを登録できます。<br>
                                ログインすると投稿の管理・編集ができます。
                            </div>
                        </div>

                        <!-- ログイン中に出す：-->
                        <div id="auth-mini-loggedin" style="display:none;">
                            <div class="auth-logged-in-row">
                                <!-- ログインID（ラベル） -->
                                <span class="login-id-chip" aria-label="登録中のID">
                                    <span class="id-lock" aria-hidden="true">🔒</span>
                                    <span class="id-label">ログイン中</span>
                                    <!-- ★ ここを reflectLoginUI で書き換える -->
                                    <span class="id-value" id="auth-username-label">マンモス</span>
                                </span>

                                <!-- アカウントデータ（既存モーダル起動） -->
                                <button class="btn danger" type="button" id="account-data-btn" data-open="accountDataModal">
                                    アカウントデータ
                                </button>

                                <!-- ログアウト -->
                                <button class="btn danger" type="button" id="auth-logout-btn">
                                    ログアウト
                                </button>
                            </div>
                            <div class="post-hint">
                                ※ ユーザーIDは投稿者名とは別です。<br>
                                　 投稿者名やXアカウントを登録することもできます。<br>
                                　 ログインすると投稿の管理や編集ができます。（ログインなしでも投稿自体はできます）
                            </div>
                        </div>


                    </div>
                </div>

                <!-- ▼ 投稿者名 -->
                <div class="info-row">
                    <div class="info-label">
                        <div>投稿者名</div>
                    </div>
                    <div class="info-value">
                        <div class="poster-line">
                            <input id="auth-display-name" name="nickname" type="text" placeholder="投稿デッキに載せる名前を入力してください" autocomplete="nickname"aria-label="投稿者の表示名" required maxlength="24" autocapitalize="off" autocorrect="off" spellcheck="false">
                        </div>
                        <div class="post-hint">
                            ※ 投稿デッキに載せる名前です。
                        </div>
                    </div>
                </div>

                <!-- Xアカウント -->
                <div class="info-row">
                    <div class="info-label any">
                        <div>Xアカウント</div>
                        <div class="any-text">(任意)</div>
                    </div>
                    <div class="info-value">
                        <div class="poster-line x-line">
                            <div class="X-info">
                            <input id="auth-x" name="social-username" type="text" placeholder="Xアカウント名（@なし可）" inputmode="verbatim"autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false">
                                <button type="button" id="x-link-btn" class="x-link-btn" title="Xプロフィールを開く">X を確認</button>
                            </div>
                        <div class="post-hint">
                        投稿内に自分のXアカウントを載せることができます。なりすましはやめてください。
                        </div>
                        </div>
                    </div>
                </div>

                <div class="info-row">
                    <label class="info-label">
                        投稿同意
                    </label>
                    <div class="info-value">
                        <label class="agree-label">
                            <input type="checkbox" id="post-agree">
                            投稿内容の公開にあたって、内容にご配慮いただけることに同意します。
                        </label>
                        <small class="agree-note">
                            ※本サイトは非公式のファンサイトです。<br>
                            他の利用者が気持ちよく閲覧できるようご協力をお願いします。
                        </small>
                    </div>
                </div>

            <div id="post-status" class="status-text">
                <div id="post-loading" class="loading-spinner" style="display:none;"></div>
            </div>

            <!-- キャンペーン告知（投稿ボタン上：開催中のみ表示） -->
            <div id="campaign-banner" class="campaign-banner" style="display:none;">
                <!-- ① 上段：🎉 + キャンペーン名 + 期間 -->
                <div class="campaign-banner-title-row">
                    <span class="campaign-banner-emoji" aria-hidden="true">🎉</span>
                    <span class="campaign-banner-title" id="campaign-banner-title">キャンペーン</span>
                    <span class="campaign-banner-range" id="campaign-banner-range"></span>
                </div>

                <!-- ② 下段：宣伝文 + 詳細ボタン（スマホでも横並び固定） -->
                <div class="campaign-banner-cta-row">
                    <div class="campaign-banner-desc" id="campaign-banner-text">
                        デッキを投稿して、キャンペーンに参加しよう！<span class="sp-break"></span>
                        <strong>詳しい参加条件や報酬は、詳細をチェック！</strong>
                    </div>

                    <button type="button" class="campaign-btn campaign-banner-btn" data-open="campaignDetailModal">
                        詳細 ▶
                    </button>
                </div>
                <!-- ③ 対象判定（まずは簡易：後でタグ連動に発展させる） -->
                    <div class="campaign-criteria">
                        <div class="criteria-item" data-criteria="login">
                            <span class="criteria-check"></span>
                            <span class="criteria-text">アカウントログイン</span>
                        </div>

                        <div class="criteria-item" data-criteria="x">
                            <span class="criteria-check"></span>
                            <span class="criteria-text">Xアカウント記入</span>
                        </div>

                        <div class="criteria-item" data-criteria="tag">
                            <span class="criteria-check"></span>
                            <span class="criteria-text">下にあるタグをタップ！</span>
                        </div>
                    </div>
                <!-- ④ 対象タグ（キャンペーン参加トグル：見た目は選択タグchipと同じ） -->
                    <div id="campaign-banner-tagrow" class="tag-chips campaign-tagrow" style="display:none;">
                        <button type="button" id="campaign-tag-toggle" class="chip" aria-pressed="false">
                            （対象タグ）
                        </button>
                    </div>
                </div>

                <div class="post-actions">
                    <button type="button" id="post-open-imagegen">画像生成</button>
                    <button type="button" id="post-reset">投稿リセット</button>
                    <button id="post-submit" type="submit">投稿</button>
                </div>


<!-- デッキ解説: 全画面編集モーダル -->
<div id="noteFullModal" class="modal" style="display:none;">
    <div class="modal-content note-fullscreen">
        <div class="note-full-head">
        <button id="note-full-close" class="note-full-close-x" type="button" aria-label="閉じる">×</button>
        </div>

        <div class="note-full-body">
            <!-- 左：テキスト側（プリセット 2×2 ＋ 本文） -->
            <div class="text-side">
                <div class="note-full-body-title">フォーマット</div>
                <div class="note-presets-grid">
                    <button type="button" class="note-preset-btn" data-preset="deck-overview">デッキ概要</button>
                    <button type="button" class="note-preset-btn" data-preset="play-guide">プレイ方針</button>
                    <button type="button" class="note-preset-btn" data-preset="matchup">対面考察</button>
                    <button type="button" class="note-preset-btn" data-preset="results">実績レポート</button>
                </div>
                <textarea id="note-full-text"
                placeholder="デッキの特徴・回し方・相性などを自由に。プリセットで雛形を挿入できます"></textarea>
                </div>

            <!-- 右：デッキリスト -->
            <div class="note-side">
                <h3 class="note-side-title" id="note-side-title"></h3>
                <div id="note-side-list" class="note-side-list"></div>
                </div>
            </div>
        </div>
</div>

<!-- ▼ カード解説：候補選択モーダル -->
<div class="modal" id="cardNoteSelectModal" style="display:none;">
    <div class="modal-content cardnote-modal">
        <h3 class="filter-maintitle">カードを選択</h3>
        <div id="cardNoteCandidates" class="cardnote-grid"><!-- JSで5列グリッド生成 --></div>

        <div class="modal-footer" style="gap:.5rem;">
            <button type="button" id="cardNoteClose" class="modal-buttun">閉じる</button>
        </div>
    </div>
</div>

<!-- Auth ローディング＆結果トースト -->
<div id="auth-status" class="auth-status" style="display:none">
    <div class="auth-status-body">
        <div class="auth-spinner"></div>
        <div class="auth-status-text" id="auth-status-text">通信中…</div>
    </div>
</div>

<!-- Auth 結果トースト -->
<div id="auth-toast" class="auth-toast" style="display:none"></div>

<!-- 投稿結果トースト -->
<div id="post-toast" class="post-toast" style="display:none"></div>

<!-- 投稿成功チェックマーク -->
<div id="success-check" class="success-check" style="display:none;">
    ✓
</div>

<!-- 投稿成功モーダル -->
<div id="postSuccessModal" class="modal" style="display:none;">
    <div class="modal-content post-success-modal">
        <button id="post-success-close" class="modal-close-x" type="button" aria-label="閉じる">×</button>

        <div class="post-success-header">
            🎉 デッキ投稿が完了しました
        </div>

        <div class="post-success-body">
            <div class="post-success-content">
                <div class="post-success-text">
                    <div class="post-success-row">
                        <span class="post-success-label">デッキ名</span>
                        <span id="post-success-deck-name" class="post-success-deck-name">（デッキ名）</span>
                    </div>
                    <p class="post-success-desc">
                    デッキ投稿一覧ページにあなたのデッキが追加されました。<br>
                    Xで投稿したことをシェアしてみましょう！<br>
                    ポスト用のデッキリスト画像は、下の「画像生成」から保存できます。
                    </p>

                    <!-- キャンペーン案内（開催中のみ表示） -->
                    <div id="post-success-campaign" class="beta-note" style="display:none; margin-top:10px;">
                        <div class="beta-note-icon">🎁</div>
                        <div class="beta-note-body">
                            <div class="beta-note-title">キャンペーン開催中</div>
                            <div id="post-success-campaign-text">（キャンペーン情報）</div>
                        </div>
                    </div>

                </div>
                <!-- 右側のプレビュー領域 -->
                <div id="post-success-preview" class="post-success-preview"></div>
            </div>
        </div>


        <div class="post-success-buttons">
            <button type="button" id="post-success-gen-image" class="btn ghost">
                🖼 デッキリスト画像を生成
            </button>
            <button type="button" id="post-success-open-posts" class="btn primary">
                📂 投稿一覧を開く
            </button>
            <button type="button" id="post-success-tweet" class="btn x-share">
                𝕏 でポストする
            </button>
        </div>
    </div>
</div>



                <!-- Hidden values -->
                <input type="hidden" id="post-deck-code" name="deckCode">
                <input type="hidden" id="post-races-hidden" name="races">
                <input type="hidden" id="post-rep-img" name="repImg">
                <input type="hidden" id="post-user-tags-hidden" name="userTags">
                <input type="hidden" id="post-poster-hidden" name="poster">
                <input type="hidden" id="post-share-code" name="shareCode">
        </form>


<!-- ▼ ログイン / 新規登録 モーダル -->
<div class="account-modal" id="authLoginModal" style="display:none;">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="authLoginModalTitle">
        <div class="account-modal-head">
            <h3 id="authLoginModalTitle">ログイン / 新規登録</h3>
            <button type="button" class="account-close" data-close="authLoginModal" aria-label="閉じる">×</button>
        </div>

        <div class="account-modal-body">
            <div class="auth-stack">
                <!-- ▼ 非ログイン時に表示（元のフォームをそのまま移植） -->
                <form id="auth-login-form" class="auth-login-form">

                    <div class="poster-line" style="margin-top:6px;">
                        <input id="auth-username" name="username" type="text" placeholder="ログインID" autocomplete="username"
                            autocapitalize="none" autocorrect="off" spellcheck="false">
                    </div>

                    <div class="poster-line">
                        <input id="auth-password" name="current-password" type="password" placeholder="パスワード"
                            autocomplete="current-password" autocapitalize="off" autocorrect="off" spellcheck="false">
                        <button type="button" id="auth-pass-toggle" class="btn ghost">表示</button>
                    </div>

                    <!-- ▼ 追加：新規登録用の確認パスワード欄 -->
                    <div class="poster-line">
                        <input id="auth-password-confirm" name="new-password-confirm" type="password" placeholder="パスワード（確認用・新規登録時のみ）"
                            autocomplete="new-password" autocapitalize="off" autocorrect="off" spellcheck="false">
                    </div>
                    <!-- ▲ ここまで追加 -->

                    <div class="auth-buttons">
                        <button class="btn primary" type="button" id="auth-signup-btn">新規登録</button>
                        <button class="btn primary" type="submit" id="auth-login-btn-submit">ログイン</button>
                    </div>

                    <p id="auth-inline-status" class="auth-inline-status" aria-live="polite" style="margin:.5rem 0 0; font-size:.9rem;">
                    </p>
                </form>

                <!-- ▼ ログイン中に表示 -->
                <div id="auth-logged-in" class="auth-logged-in" style="display:none;">
                    <p style="margin:0;">ログイン中です。</p>
                    <p style="margin:4px 0 0; font-size:.85rem; opacity:.8;">
                        アカウント情報の変更は、投稿フォーム内の「ログイン」行から行えます。
                    </p>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- ▼ アカウントデータ モーダル（form版） -->
<div class="account-modal" id="accountDataModal" style="display:none;">
    <form id="account-data-form" class="modal-content" role="dialog" aria-modal="true"
        aria-labelledby="accountModalTitle">

        <div class="account-modal-head">
            <h3 id="accountModalTitle">アカウントデータ変更</h3>
            <button type="button" class="account-close" data-close="accountDataModal" aria-label="閉じる">×</button>
        </div>

        <div class="account-modal-body">
            <!-- 新しいログイン名 -->
            <div class="account-field">
                <label>新しいログイン名</label>
                <input id="acct-login-name" name="new-username" type="text" autocomplete="username"
                    placeholder="新しいログイン名を入力">
            </div>

            <!-- 新しいパスワード -->
            <div class="account-field">
                <label>新しいパスワード</label>
                <div class="account-pass-row">
                    <input id="acct-password" name="new-password" type="password" autocomplete="new-password"
                        placeholder="※4文字以上">
                    <button type="button" class="btn ghost" id="acct-pass-toggle">表示</button>
                </div>
                <small class="account-hint">※ 保存時に現在のパスワード確認を行います</small>
            </div>

            <!-- 投稿者名 -->
            <div class="account-field">
                <label>投稿者名</label>
                <input id="acct-poster-name" name="poster-name" type="text" autocomplete="nickname"
                    placeholder="投稿に表示する名前（任意）">
            </div>

            <!-- Xアカウント -->
            <div class="account-field">
                <label>Xアカウント</label>
                <div class="X-info">
                    <input id="acct-x" name="poster-x" type="text" inputmode="verbatim" placeholder="（@なし可）">
                    <button type="button" class="x-link-btn" id="acct-x-open" title="Xプロフィールを開く">X を確認</button>
                </div>
            </div>

            <div class="account-note">
                ※ 投稿者名・Xアカウントを登録すると、次回以降のログイン時に自動入力されます。
            </div>
        </div>

        <div class="account-modal-footer">
            <button type="button" class="btn ghost" data-close="accountDataModal">キャンセル</button>
            <!-- クリックで JS が送信するので type="button" のままでOK -->
            <button type="button" class="btn danger" id="acct-save-btn" disabled>保存</button>
        </div>

    </form>
</div>



<!-- ▼ パスワード保存用の隠しログインフォーム -->
<form id="auth-login-save" method="get" action="" target="auth-login-save-frame" autocomplete="on" style="position:absolute; left:-9999px; top:-9999px;
             width:1px; height:1px; overflow:hidden;
             opacity:0; pointer-events:none;">
    <input type="text" name="username" autocomplete="username">
    <input type="password" name="password" autocomplete="current-password">
</form>
<iframe name="auth-login-save-frame" style="display:none;"></iframe>

</div>

        </div>

        </div>


    <!-- ▼ カード操作モーダル -->
    <div id="cardOpModal" class="modal">
        <div class="modal-content cardop-modal" id="cardOpModalContent" role="dialog" aria-modal="true"
            aria-labelledby="cardOpTitle">
            <div class="cardop-header" id="cardOpHeader">
                <div class="cardop-topline">
                    <span class="cardop-move-hint">
                        ドラッグでミニウィンドウ移動可
                        <br>
                        ×で閉じる
                    </span>
                    <button type="button" class="cardop-close" id="cardOpCloseBtn" aria-label="閉じる">×</button>
                </div>
                <h3 id="cardOpTitle" class="cardop-title"></h3>
            </div>

            <div class="cardop-body">
                <!-- 上：カード画像（枚数バッジ付き） -->
                <div class="cardop-figure">
                    <img id="cardOpImg" alt="">
                    <div class="count-badge" id="cardOpCountBadge">x1</div>
                </div>

                <!-- 操作：1行目（- / +） -->
                <div class="cardop-row">
                    <button type="button" class="cardop-btn grow" id="cardOpDec">－</button>
                    <button type="button" class="cardop-btn grow" id="cardOpInc">＋</button>
                </div>

                <!-- 操作：2行目（メインカードにする） -->
                <div class="cardop-row">
                    <button type="button" class="cardop-btn primary full" id="cardOpSetRep">このカードをメインカードにする</button>
                </div>

                <!-- 効果一覧 -->
                <div class="cardop-effects" id="cardOpEffects"></div>
            </div>
        </div>
    </div>

    <!-- ▼ メインカード：選択モーダル -->
    <div class="modal" id="repSelectModal" style="display:none;">
        <div class="modal-content cardnote-modal">
            <h3 class="filter-maintitle">メインカードを選択</h3>
            <div id="repSelectGrid" class="cardnote-grid"><!-- JSで5列グリッド生成 --></div>
            <div class="modal-footer" style="gap:.5rem;">
                <button type="button" id="repSelectClose" class="modal-buttun">閉じる</button>
            </div>
        </div>
    </div>

    </div>


    <!-- 保存デッキ一覧表示用 -->
    <div id="saved-deck">
        <h3 class="saved-deck-title">保存デッキ一覧</h3>
        <div id="savedDeckCount"></div>
    </div>
    <div id="savedDeckList">
        <!--保存デッキリスト-->
    </div>

    <p class="saved-deck-massage">
        ⚠️ デッキはブラウザに保存されます。キャッシュを削除するとデータが消えるのでご注意ください。
    </p>
</div>

<!--上部に戻るボタン-->
<button id="scrollTopFixed" onclick="scrollToTop()">▲</button>

<!--フッター-->
<footer>
    <div>
        <p>
            <strong>モスロギア</strong> はアプリ『神託のメソロギア』の非公式ファンサイトです。<br>
            カード一覧検索やデッキメーカー、デッキ分析などを通じて、プレイヤー向けに便利なデータベース機能を提供しています。
        </p>
    </div>

    <p>
        🔗 公式サイトはこちら 👉
        <a href="https://mythologiatheoracle.com/" target="_blank" rel="noopener noreferrer">
            神託のメソロギア公式サイト
        </a>
    </p>

    © 2025 Mesorogia Cards. All rights reserved.<br />
    当サイトは「神託のメソロギア」の非公式ファンサイトです。画像・データ等の著作権は各権利者に帰属します。<br />
    一部画像素材は「ジュエルセイバーFREE」<br />
    （<a href="https://www.jewel-s.jp/" target="_blank" rel="noopener">https://www.jewel-s.jp/</a>）を使用しています。<br />
    💬 ご要望・不具合報告 👉
    <a href="https://x.com/192837465aruneo" target="_blank" rel="noopener noreferrer">
        @192837465aruneo
    </a>
</footer>

<!-- デッキ投稿の流れ ヘルプモーダル -->
<div id="postFlowHelpModal" class="modal" style="display:none;">
    <div class="modal-content post-flow-modal">
        <button id="post-flow-help-close" class="modal-close-x" type="button" aria-label="閉じる">×</button>

        <h3 class="post-flow-title">
            <span>❓ デッキ投稿の流れ</span>
        </h3>

        <ol class="post-flow-steps">
            <li>「🃏 デッキ構築」タブで、デッキを組みましょう。</li>
            <li>「📋 デッキ情報」内で枚数・種族・レアリティなどを確認しましょう。</li>
            <li>「📤 デッキ投稿」サブタブに進みます。投稿内のデッキ名・投稿コメント・タグなどの記入欄を埋めていきましょう。</li>
            <li>最後に、投稿チェック」にチェックを入れてから、一番下の「デッキを投稿する」ボタンを押したら投稿完了です！</li>
        </ol>

        <p class="post-flow-note">
            ※ 投稿後は「デッキ投稿一覧ページ」にあなたのデッキが追加されます。
        </p>
    </div>
</div>


<!-- JS -->
<script src="js/common.js"></script>
<script src="js/common-page124.js"></script>
<script src="js/common-page234.js"></script>
<script src="js/common-page24.js"></script>
<script src="js/page2.js"></script>
</body>

</html>

